{"ast":null,"code":"// Interface to the REST server\nconst baseURL = \"http://localhost:3001/\"; //const baseURL = \"http://www.debestrobotics.com/\";\n\nvar currSessionCookie;\nconst headers = new Headers();\nheaders.set('Content-Type', 'application/JSON');\n\nfunction myFetch(method, endpoint, body) {\n  return fetch(baseURL + endpoint, {\n    method: method,\n    body: body ? JSON.stringify(body) : null,\n    headers: headers,\n    credentials: 'include'\n  }).catch(err => {\n    throw err;\n  });\n}\n\nexport function post(endpoint, body) {\n  return myFetch('POST', endpoint, body);\n} // GET/Usr/{email}\n\nexport function get(endpoint, body) {\n  return myFetch('GET', endpoint, body);\n} // GET/Usr \n//export function get(endpoint){\n//   return myFetch('GET', endpoint);\n//}\n\nexport function put(endpoint, body) {\n  return myFetch('PUT', endpoint, body);\n}\nexport function del(endpoint) {\n  return myFetch('DELETE', endpoint);\n} //  Functions for api requests\n\n/**\n * Register a user\n * @param {Object} User info\n * @returns {Promise resolving to new user registration}\n */\n\nexport function signUp(info) {\n  return post('Usr', info).catch(err => {\n    throw err;\n  });\n}\nexport function templogIn(creds) {\n  return post('Ssns', creds).catch(err => {\n    throw err;\n  });\n}\nexport function logOut() {\n  return del('Ssns/' + currSessionCookie).catch(err => {\n    throw err;\n  });\n}\nexport function logIn(cred) {\n  return post(\"Ssns\", cred).then(response => {\n    let location = response.headers.get(\"Location\").split('/');\n    sessionId = location[location.length - 1];\n    console.log(\"Got session \" + sessionId);\n    return get(\"Ssns/\" + sessionId);\n  }).then(response => response.json()) // ..json() returns a Promise!\n  .then(rsp => get('Prss/' + rsp.prsId)).then(userResponse => userResponse.json()).then(rsp => rsp[0]).catch(err => {\n    console.log('err was this', err);\n    throw err;\n  });\n}\n\nfunction createErrorPromise(response) {\n  if (response.status === 400) return Promise.resolve(response).then(response => response.json()).then(errorList => Promise.reject(errorList.map(err => errorTranslate(err.tag))));else return Promise.reject([\"Unknown error\"]);\n}\n/**\n * @param User email to index database\n * @returns {Promise} json parsed data\n */\n\n\nexport function getUser(email) {\n  return get('Usr/' + email).then(res => res.json()).catch(err => {\n    throw err;\n  });\n}","map":{"version":3,"sources":["/Users/joshdebest/SeniorProject2020/ClientSide/src/api.js"],"names":["baseURL","currSessionCookie","headers","Headers","set","myFetch","method","endpoint","body","fetch","JSON","stringify","credentials","catch","err","post","get","put","del","signUp","info","templogIn","creds","logOut","logIn","cred","then","response","location","split","sessionId","length","console","log","json","rsp","prsId","userResponse","createErrorPromise","status","Promise","resolve","errorList","reject","map","errorTranslate","tag","getUser","email","res"],"mappings":"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","sourcesContent":["// Interface to the REST server\n\nconst baseURL = \"http://localhost:3001/\";\n//const baseURL = \"http://www.debestrobotics.com/\";\n\nvar currSessionCookie;\nconst headers = new Headers();\nheaders.set('Content-Type', 'application/JSON');\n\nfunction myFetch(method, endpoint, body){\n   return fetch(baseURL + endpoint, {\n      method: method,\n      body: (body ? JSON.stringify(body) : null),\n      headers: headers,\n      credentials: 'include'\n   }).catch(err => {throw err});\n}\n\nexport function post(endpoint, body){\n   return myFetch('POST', endpoint, body);\n}\n// GET/Usr/{email}\nexport function get(endpoint, body){\n   return myFetch('GET', endpoint, body);\n}\n// GET/Usr \n//export function get(endpoint){\n//   return myFetch('GET', endpoint);\n//}\n\nexport function put(endpoint, body){\n   return myFetch('PUT', endpoint, body);\n}\nexport function del(endpoint){\n   return myFetch('DELETE', endpoint);\n}\n\n//  Functions for api requests\n\n/**\n * Register a user\n * @param {Object} User info\n * @returns {Promise resolving to new user registration}\n */\nexport function signUp(info){\n   return post('Usr', info).catch(err => {throw err});\n}\n\nexport function templogIn(creds){\n   return post('Ssns', creds).catch(err => {throw err});\n}\n\nexport function logOut(){\n   return del('Ssns/' + currSessionCookie).catch(err => {throw err});\n}\n\nexport function logIn(cred) {\n   return post(\"Ssns\", cred)\n      .then(response => {\n         let location = response.headers.get(\"Location\").split('/');\n         sessionId = location[location.length - 1];\n         console.log(\"Got session \" + sessionId);\n         return get(\"Ssns/\" + sessionId)\n      })\n      .then(response => response.json())   // ..json() returns a Promise!\n      .then(rsp => get('Prss/' + rsp.prsId))\n      .then(userResponse => userResponse.json())\n      .then(rsp => rsp[0])\n      .catch(err => {console.log('err was this',err);throw err}) \n}\n\nfunction createErrorPromise(response) {\n    if (response.status === 400)\n       return Promise.resolve(response)\n       .then(response => response.json())\n       .then(errorList => Promise.reject(errorList.map(\n          err => errorTranslate(err.tag))));\n    else\n       return Promise.reject([\"Unknown error\"]);\n }\n\n/**\n * @param User email to index database\n * @returns {Promise} json parsed data\n */\nexport function getUser(email) {\n   return get ('Usr/' + email)\n   .then(res => res.json())\n   .catch(err => {throw err});\n}"]},"metadata":{},"sourceType":"module"}